# ğŸ§© Supabase Backend Layer â€” Speechwriter / MicroFactory Standard

This folder defines the **database layer** for the Speechwriter app.  
It is also the **baseline Supabase architecture** used by all MicroFactory products.

---

## ğŸ“‚ Folder Structure

supabase/  
â”œâ”€â”€ migrations/  
â”‚ â””â”€â”€ 20251107_add_subscription_and_token_tracking.sql  
â”œâ”€â”€ config.toml # Optional â€” used by Supabase CLI  
â””â”€â”€ README.md # This file

---

## ğŸ§± Purpose

This directory stores **version-controlled database migrations** â€” the SQL scripts that build and evolve your Supabase backend.  
Each file defines **one atomic schema update** (tables, functions, triggers, RLS policies, etc.) and is **idempotent** â€” safe to run repeatedly.

You can think of this folder as the **source code of your database**, just as `apps/web/` is the source code of your frontend.

---

## âš™ï¸ Core Concepts

| Component         | Description                                                                                                   |
| ----------------- | ------------------------------------------------------------------------------------------------------------- |
| **Migrations**    | SQL scripts that define all schema changes â€” created tables, policies, triggers, functions, etc.              |
| **config.toml**   | Optional Supabase CLI configuration file (e.g. project reference ID, database URL).                           |
| **RLS Policies**  | All tables must use **Row Level Security** â€” this ensures per-user data isolation.                            |
| **RPC Functions** | Custom server-side logic (e.g. `consume_tokens()`, `handle_new_user_subscription()`) lives in the migrations. |
| **Triggers**      | Database automations that respond to events (e.g. create subscription on new signup).                         |

---

## ğŸªœ How to Apply Migrations

You have two ways to apply migrations:

### 1ï¸âƒ£ Manual (via Supabase SQL Editor)

1. Copy the contents of the migration file.
2. Open your project in [Supabase](https://supabase.com/dashboard).
3. Go to **SQL Editor â†’ New Query**.
4. Paste and run the SQL.

### 2ï¸âƒ£ Automatic (using Supabase CLI)

_(Optional â€” for future automation via Cursor or CI/CD)_

```bash
# Install CLI locally (once)
pnpm add -D supabase

# Link to your project (once)
npx supabase link --project-ref your_project_ref

# Apply all pending migrations
npx supabase db push
```
